{% extends "compradoresApp/base.html" %}
{% block title %}{{ product.title }} — Artesano{% endblock %}
{% block content %}
<div class="product-detail">
  <div class="left">
    {% if product.image %}<img src="{{ product.image.url }}" alt="{{ product.title }}" class="bigimg">{% endif %}
    <div class="share">
      <p>Compartir:</p>
      <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}">Facebook</a> |
      <a target="_blank" href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}&text={{ product.title }}">Twitter</a>
    </div>
  </div>

  <div class="right">
    <h1>{{ product.title }}</h1>
    <p class="meta">{{ product.category.name if product.category else '' }} • {{ product.location }}</p>
    <div class="price">Precio: <strong>${{ product.price }}</strong></div>
    <p class="desc">{{ product.description }}</p>

    <div class="actions">
      <form method="post" action="{% url 'compradores:create_order' product.pk %}">{% csrf_token %}
        <button class="btn">Comprar</button>
      </form>

      <form method="post" action="{% url 'compradores:toggle_favorite' product.pk %}">{% csrf_token %}
        <button class="btn ghost">{% if is_fav %}Quitar favorito{% else %}Agregar favorito{% endif %}</button>
      </form>
    </div>

    <hr>

    <h3>Reseñas</h3>
    {% for r in reviews %}
      <div class="review">
        <div class="r-head">
          <strong>{{ r.author.username }}</strong>
          <span class="small"> — {{ r.created_at|date:"SHORT_DATETIME_FORMAT" }}</span>
          <span class="rating">⭐ {{ r.rating }}</span>
        </div>
        <p>{{ r.comment }}</p>
        {% if r.artisan_response %}
          <div class="artisan-response">Respuesta del artesano: {{ r.artisan_response }}</div>
        {% endif %}
      </div>
    {% empty %}
      <p>No hay reseñas todavía. Sé el primero en dejar una.</p>
    {% endfor %}
  </div>
</div>

<div class="review-box">
  {% include "compradoresApp/review_form.html" %}
</div>
{% endblock %}
